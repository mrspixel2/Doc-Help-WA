{"ast":null,"code":"/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule convertFromHTMLToContentBlocks\n * @format\n * \n */\n'use strict';\n\nvar _extends = _assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _knownListItemDepthCl,\n    _assign = require('object-assign');\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar CharacterMetadata = require('./CharacterMetadata');\n\nvar ContentBlock = require('./ContentBlock');\n\nvar ContentBlockNode = require('./ContentBlockNode');\n\nvar DefaultDraftBlockRenderMap = require('./DefaultDraftBlockRenderMap');\n\nvar DraftEntity = require('./DraftEntity');\n\nvar DraftFeatureFlags = require('./DraftFeatureFlags');\n\nvar Immutable = require('immutable');\n\nvar _require = require('immutable'),\n    Set = _require.Set;\n\nvar URI = require('fbjs/lib/URI');\n\nvar cx = require('fbjs/lib/cx');\n\nvar generateRandomKey = require('./generateRandomKey');\n\nvar getSafeBodyFromHTML = require('./getSafeBodyFromHTML');\n\nvar invariant = require('fbjs/lib/invariant');\n\nvar sanitizeDraftText = require('./sanitizeDraftText');\n\nvar experimentalTreeDataSupport = DraftFeatureFlags.draft_tree_data_support;\nvar List = Immutable.List,\n    OrderedSet = Immutable.OrderedSet;\nvar NBSP = '&nbsp;';\nvar SPACE = ' '; // Arbitrary max indent\n\nvar MAX_DEPTH = 4; // used for replacing characters in HTML\n\nvar REGEX_CR = new RegExp('\\r', 'g');\nvar REGEX_LF = new RegExp('\\n', 'g');\nvar REGEX_NBSP = new RegExp(NBSP, 'g');\nvar REGEX_CARRIAGE = new RegExp('&#13;?', 'g');\nvar REGEX_ZWS = new RegExp('&#8203;?', 'g'); // https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight\n\nvar boldValues = ['bold', 'bolder', '500', '600', '700', '800', '900'];\nvar notBoldValues = ['light', 'lighter', '100', '200', '300', '400']; // Block tag flow is different because LIs do not have\n// a deterministic style ;_;\n\nvar inlineTags = {\n  b: 'BOLD',\n  code: 'CODE',\n  del: 'STRIKETHROUGH',\n  em: 'ITALIC',\n  i: 'ITALIC',\n  s: 'STRIKETHROUGH',\n  strike: 'STRIKETHROUGH',\n  strong: 'BOLD',\n  u: 'UNDERLINE'\n};\nvar knownListItemDepthClasses = (_knownListItemDepthCl = {}, _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth0'), 0), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth1'), 1), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth2'), 2), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth3'), 3), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth4'), 4), _knownListItemDepthCl);\nvar anchorAttr = ['className', 'href', 'rel', 'target', 'title'];\nvar imgAttr = ['alt', 'className', 'height', 'src', 'width'];\nvar lastBlock = void 0;\nvar EMPTY_CHUNK = {\n  text: '',\n  inlines: [],\n  entities: [],\n  blocks: []\n};\nvar EMPTY_BLOCK = {\n  children: List(),\n  depth: 0,\n  key: '',\n  type: ''\n};\n\nvar getListBlockType = function getListBlockType(tag, lastList) {\n  if (tag === 'li') {\n    return lastList === 'ol' ? 'ordered-list-item' : 'unordered-list-item';\n  }\n\n  return null;\n};\n\nvar getBlockMapSupportedTags = function getBlockMapSupportedTags(blockRenderMap) {\n  var unstyledElement = blockRenderMap.get('unstyled').element;\n  var tags = Set([]);\n  blockRenderMap.forEach(function (draftBlock) {\n    if (draftBlock.aliasedElements) {\n      draftBlock.aliasedElements.forEach(function (tag) {\n        tags = tags.add(tag);\n      });\n    }\n\n    tags = tags.add(draftBlock.element);\n  });\n  return tags.filter(function (tag) {\n    return tag && tag !== unstyledElement;\n  }).toArray().sort();\n}; // custom element conversions\n\n\nvar getMultiMatchedType = function getMultiMatchedType(tag, lastList, multiMatchExtractor) {\n  for (var ii = 0; ii < multiMatchExtractor.length; ii++) {\n    var matchType = multiMatchExtractor[ii](tag, lastList);\n\n    if (matchType) {\n      return matchType;\n    }\n  }\n\n  return null;\n};\n\nvar getBlockTypeForTag = function getBlockTypeForTag(tag, lastList, blockRenderMap) {\n  var matchedTypes = blockRenderMap.filter(function (draftBlock) {\n    return draftBlock.element === tag || draftBlock.wrapper === tag || draftBlock.aliasedElements && draftBlock.aliasedElements.some(function (alias) {\n      return alias === tag;\n    });\n  }).keySeq().toSet().toArray().sort(); // if we dont have any matched type, return unstyled\n  // if we have one matched type return it\n  // if we have multi matched types use the multi-match function to gather type\n\n  switch (matchedTypes.length) {\n    case 0:\n      return 'unstyled';\n\n    case 1:\n      return matchedTypes[0];\n\n    default:\n      return getMultiMatchedType(tag, lastList, [getListBlockType]) || 'unstyled';\n  }\n};\n\nvar processInlineTag = function processInlineTag(tag, node, currentStyle) {\n  var styleToCheck = inlineTags[tag];\n\n  if (styleToCheck) {\n    currentStyle = currentStyle.add(styleToCheck).toOrderedSet();\n  } else if (node instanceof HTMLElement) {\n    var htmlElement = node;\n    currentStyle = currentStyle.withMutations(function (style) {\n      var fontWeight = htmlElement.style.fontWeight;\n      var fontStyle = htmlElement.style.fontStyle;\n      var textDecoration = htmlElement.style.textDecoration;\n\n      if (boldValues.indexOf(fontWeight) >= 0) {\n        style.add('BOLD');\n      } else if (notBoldValues.indexOf(fontWeight) >= 0) {\n        style.remove('BOLD');\n      }\n\n      if (fontStyle === 'italic') {\n        style.add('ITALIC');\n      } else if (fontStyle === 'normal') {\n        style.remove('ITALIC');\n      }\n\n      if (textDecoration === 'underline') {\n        style.add('UNDERLINE');\n      }\n\n      if (textDecoration === 'line-through') {\n        style.add('STRIKETHROUGH');\n      }\n\n      if (textDecoration === 'none') {\n        style.remove('UNDERLINE');\n        style.remove('STRIKETHROUGH');\n      }\n    }).toOrderedSet();\n  }\n\n  return currentStyle;\n};\n\nvar joinChunks = function joinChunks(A, B, experimentalHasNestedBlocks) {\n  // Sometimes two blocks will touch in the DOM and we need to strip the\n  // extra delimiter to preserve niceness.\n  var lastInA = A.text.slice(-1);\n  var firstInB = B.text.slice(0, 1);\n\n  if (lastInA === '\\r' && firstInB === '\\r' && !experimentalHasNestedBlocks) {\n    A.text = A.text.slice(0, -1);\n    A.inlines.pop();\n    A.entities.pop();\n    A.blocks.pop();\n  } // Kill whitespace after blocks\n\n\n  if (lastInA === '\\r') {\n    if (B.text === SPACE || B.text === '\\n') {\n      return A;\n    } else if (firstInB === SPACE || firstInB === '\\n') {\n      B.text = B.text.slice(1);\n      B.inlines.shift();\n      B.entities.shift();\n    }\n  }\n\n  return {\n    text: A.text + B.text,\n    inlines: A.inlines.concat(B.inlines),\n    entities: A.entities.concat(B.entities),\n    blocks: A.blocks.concat(B.blocks)\n  };\n};\n/**\n * Check to see if we have anything like <p> <blockquote> <h1>... to create\n * block tags from. If we do, we can use those and ignore <div> tags. If we\n * don't, we can treat <div> tags as meaningful (unstyled) blocks.\n */\n\n\nvar containsSemanticBlockMarkup = function containsSemanticBlockMarkup(html, blockTags) {\n  return blockTags.some(function (tag) {\n    return html.indexOf('<' + tag) !== -1;\n  });\n};\n\nvar hasValidLinkText = function hasValidLinkText(link) {\n  !(link instanceof HTMLAnchorElement) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Link must be an HTMLAnchorElement.') : invariant(false) : void 0;\n  var protocol = link.protocol;\n  return protocol === 'http:' || protocol === 'https:' || protocol === 'mailto:';\n};\n\nvar getWhitespaceChunk = function getWhitespaceChunk(inEntity) {\n  var entities = new Array(1);\n\n  if (inEntity) {\n    entities[0] = inEntity;\n  }\n\n  return _extends({}, EMPTY_CHUNK, {\n    text: SPACE,\n    inlines: [OrderedSet()],\n    entities: entities\n  });\n};\n\nvar getSoftNewlineChunk = function getSoftNewlineChunk() {\n  return _extends({}, EMPTY_CHUNK, {\n    text: '\\n',\n    inlines: [OrderedSet()],\n    entities: new Array(1)\n  });\n};\n\nvar getChunkedBlock = function getChunkedBlock() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return _extends({}, EMPTY_BLOCK, props);\n};\n\nvar getBlockDividerChunk = function getBlockDividerChunk(block, depth) {\n  var parentKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return {\n    text: '\\r',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: [getChunkedBlock({\n      parent: parentKey,\n      key: generateRandomKey(),\n      type: block,\n      depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n    })]\n  };\n};\n/**\n *  If we're pasting from one DraftEditor to another we can check to see if\n *  existing list item depth classes are being used and preserve this style\n */\n\n\nvar getListItemDepth = function getListItemDepth(node) {\n  var depth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  Object.keys(knownListItemDepthClasses).some(function (depthClass) {\n    if (node.classList.contains(depthClass)) {\n      depth = knownListItemDepthClasses[depthClass];\n    }\n  });\n  return depth;\n};\n\nvar genFragment = function genFragment(entityMap, node, inlineStyle, lastList, inBlock, blockTags, depth, blockRenderMap, inEntity, parentKey) {\n  var lastLastBlock = lastBlock;\n  var nodeName = node.nodeName.toLowerCase();\n  var newEntityMap = entityMap;\n  var nextBlockType = 'unstyled';\n  var newBlock = false;\n  var inBlockType = inBlock && getBlockTypeForTag(inBlock, lastList, blockRenderMap);\n\n  var chunk = _extends({}, EMPTY_CHUNK);\n\n  var newChunk = null;\n  var blockKey = void 0; // Base Case\n\n  if (nodeName === '#text') {\n    var _text = node.textContent;\n\n    var nodeTextContent = _text.trim(); // We should not create blocks for leading spaces that are\n    // existing around ol/ul and their children list items\n\n\n    if (lastList && nodeTextContent === '' && node.parentElement) {\n      var parentNodeName = node.parentElement.nodeName.toLowerCase();\n\n      if (parentNodeName === 'ol' || parentNodeName === 'ul') {\n        return {\n          chunk: _extends({}, EMPTY_CHUNK),\n          entityMap: entityMap\n        };\n      }\n    }\n\n    if (nodeTextContent === '' && inBlock !== 'pre') {\n      return {\n        chunk: getWhitespaceChunk(inEntity),\n        entityMap: entityMap\n      };\n    }\n\n    if (inBlock !== 'pre') {\n      // Can't use empty string because MSWord\n      _text = _text.replace(REGEX_LF, SPACE);\n    } // save the last block so we can use it later\n\n\n    lastBlock = nodeName;\n    return {\n      chunk: {\n        text: _text,\n        inlines: Array(_text.length).fill(inlineStyle),\n        entities: Array(_text.length).fill(inEntity),\n        blocks: []\n      },\n      entityMap: entityMap\n    };\n  } // save the last block so we can use it later\n\n\n  lastBlock = nodeName; // BR tags\n\n  if (nodeName === 'br') {\n    if (lastLastBlock === 'br' && (!inBlock || inBlockType === 'unstyled')) {\n      return {\n        chunk: getBlockDividerChunk('unstyled', depth, parentKey),\n        entityMap: entityMap\n      };\n    }\n\n    return {\n      chunk: getSoftNewlineChunk(),\n      entityMap: entityMap\n    };\n  } // IMG tags\n\n\n  if (nodeName === 'img' && node instanceof HTMLImageElement && node.attributes.getNamedItem('src') && node.attributes.getNamedItem('src').value) {\n    var image = node;\n    var entityConfig = {};\n    imgAttr.forEach(function (attr) {\n      var imageAttribute = image.getAttribute(attr);\n\n      if (imageAttribute) {\n        entityConfig[attr] = imageAttribute;\n      }\n    }); // Forcing this node to have children because otherwise no entity will be\n    // created for this node.\n    // The child text node cannot just have a space or return as content -\n    // we strip those out.\n    // See https://github.com/facebook/draft-js/issues/231 for some context.\n\n    node.textContent = '\\uD83D\\uDCF7'; // TODO: update this when we remove DraftEntity entirely\n\n    inEntity = DraftEntity.__create('IMAGE', 'MUTABLE', entityConfig || {});\n  } // Inline tags\n\n\n  inlineStyle = processInlineTag(nodeName, node, inlineStyle); // Handle lists\n\n  if (nodeName === 'ul' || nodeName === 'ol') {\n    if (lastList) {\n      depth += 1;\n    }\n\n    lastList = nodeName;\n  }\n\n  if (!experimentalTreeDataSupport && nodeName === 'li' && node instanceof HTMLElement) {\n    depth = getListItemDepth(node, depth);\n  }\n\n  var blockType = getBlockTypeForTag(nodeName, lastList, blockRenderMap);\n  var inListBlock = lastList && inBlock === 'li' && nodeName === 'li';\n  var inBlockOrHasNestedBlocks = (!inBlock || experimentalTreeDataSupport) && blockTags.indexOf(nodeName) !== -1; // Block Tags\n\n  if (inListBlock || inBlockOrHasNestedBlocks) {\n    chunk = getBlockDividerChunk(blockType, depth, parentKey);\n    blockKey = chunk.blocks[0].key;\n    inBlock = nodeName;\n    newBlock = !experimentalTreeDataSupport;\n  } // this is required so that we can handle 'ul' and 'ol'\n\n\n  if (inListBlock) {\n    nextBlockType = lastList === 'ul' ? 'unordered-list-item' : 'ordered-list-item';\n  } // Recurse through children\n\n\n  var child = node.firstChild;\n\n  if (child != null) {\n    nodeName = child.nodeName.toLowerCase();\n  }\n\n  var entityId = null;\n\n  while (child) {\n    if (child instanceof HTMLAnchorElement && child.href && hasValidLinkText(child)) {\n      (function () {\n        var anchor = child;\n        var entityConfig = {};\n        anchorAttr.forEach(function (attr) {\n          var anchorAttribute = anchor.getAttribute(attr);\n\n          if (anchorAttribute) {\n            entityConfig[attr] = anchorAttribute;\n          }\n        });\n        entityConfig.url = new URI(anchor.href).toString(); // TODO: update this when we remove DraftEntity completely\n\n        entityId = DraftEntity.__create('LINK', 'MUTABLE', entityConfig || {});\n      })();\n    } else {\n      entityId = undefined;\n    }\n\n    var _genFragment = genFragment(newEntityMap, child, inlineStyle, lastList, inBlock, blockTags, depth, blockRenderMap, entityId || inEntity, experimentalTreeDataSupport ? blockKey : null),\n        generatedChunk = _genFragment.chunk,\n        maybeUpdatedEntityMap = _genFragment.entityMap;\n\n    newChunk = generatedChunk;\n    newEntityMap = maybeUpdatedEntityMap;\n    chunk = joinChunks(chunk, newChunk, experimentalTreeDataSupport);\n    var sibling = child.nextSibling; // Put in a newline to break up blocks inside blocks\n\n    if (!parentKey && sibling && blockTags.indexOf(nodeName) >= 0 && inBlock) {\n      chunk = joinChunks(chunk, getSoftNewlineChunk());\n    }\n\n    if (sibling) {\n      nodeName = sibling.nodeName.toLowerCase();\n    }\n\n    child = sibling;\n  }\n\n  if (newBlock) {\n    chunk = joinChunks(chunk, getBlockDividerChunk(nextBlockType, depth, parentKey));\n  }\n\n  return {\n    chunk: chunk,\n    entityMap: newEntityMap\n  };\n};\n\nvar getChunkForHTML = function getChunkForHTML(html, DOMBuilder, blockRenderMap, entityMap) {\n  html = html.trim().replace(REGEX_CR, '').replace(REGEX_NBSP, SPACE).replace(REGEX_CARRIAGE, '').replace(REGEX_ZWS, '');\n  var supportedBlockTags = getBlockMapSupportedTags(blockRenderMap);\n  var safeBody = DOMBuilder(html);\n\n  if (!safeBody) {\n    return null;\n  }\n\n  lastBlock = null; // Sometimes we aren't dealing with content that contains nice semantic\n  // tags. In this case, use divs to separate everything out into paragraphs\n  // and hope for the best.\n\n  var workingBlocks = containsSemanticBlockMarkup(html, supportedBlockTags) ? supportedBlockTags : ['div']; // Start with -1 block depth to offset the fact that we are passing in a fake\n  // UL block to start with.\n\n  var fragment = genFragment(entityMap, safeBody, OrderedSet(), 'ul', null, workingBlocks, -1, blockRenderMap);\n  var chunk = fragment.chunk;\n  var newEntityMap = fragment.entityMap; // join with previous block to prevent weirdness on paste\n\n  if (chunk.text.indexOf('\\r') === 0) {\n    chunk = {\n      text: chunk.text.slice(1),\n      inlines: chunk.inlines.slice(1),\n      entities: chunk.entities.slice(1),\n      blocks: chunk.blocks\n    };\n  } // Kill block delimiter at the end\n\n\n  if (chunk.text.slice(-1) === '\\r') {\n    chunk.text = chunk.text.slice(0, -1);\n    chunk.inlines = chunk.inlines.slice(0, -1);\n    chunk.entities = chunk.entities.slice(0, -1);\n    chunk.blocks.pop();\n  } // If we saw no block tags, put an unstyled one in\n\n\n  if (chunk.blocks.length === 0) {\n    chunk.blocks.push(_extends({}, EMPTY_CHUNK, {\n      type: 'unstyled',\n      depth: 0\n    }));\n  } // Sometimes we start with text that isn't in a block, which is then\n  // followed by blocks. Need to fix up the blocks to add in\n  // an unstyled block for this content\n\n\n  if (chunk.text.split('\\r').length === chunk.blocks.length + 1) {\n    chunk.blocks.unshift({\n      type: 'unstyled',\n      depth: 0\n    });\n  }\n\n  return {\n    chunk: chunk,\n    entityMap: newEntityMap\n  };\n};\n\nvar convertChunkToContentBlocks = function convertChunkToContentBlocks(chunk) {\n  if (!chunk || !chunk.text || !Array.isArray(chunk.blocks)) {\n    return null;\n  }\n\n  var initialState = {\n    cacheRef: {},\n    contentBlocks: []\n  };\n  var start = 0;\n  var rawBlocks = chunk.blocks,\n      rawInlines = chunk.inlines,\n      rawEntities = chunk.entities;\n  var BlockNodeRecord = experimentalTreeDataSupport ? ContentBlockNode : ContentBlock;\n  return chunk.text.split('\\r').reduce(function (acc, textBlock, index) {\n    // Make absolutely certain that our text is acceptable.\n    textBlock = sanitizeDraftText(textBlock);\n    var block = rawBlocks[index];\n    var end = start + textBlock.length;\n    var inlines = rawInlines.slice(start, end);\n    var entities = rawEntities.slice(start, end);\n    var characterList = List(inlines.map(function (style, index) {\n      var data = {\n        style: style,\n        entity: null\n      };\n\n      if (entities[index]) {\n        data.entity = entities[index];\n      }\n\n      return CharacterMetadata.create(data);\n    }));\n    start = end + 1;\n    var depth = block.depth,\n        type = block.type,\n        parent = block.parent;\n    var key = block.key || generateRandomKey();\n    var parentTextNodeKey = null; // will be used to store container text nodes\n    // childrens add themselves to their parents since we are iterating in order\n\n    if (parent) {\n      var parentIndex = acc.cacheRef[parent];\n      var parentRecord = acc.contentBlocks[parentIndex]; // if parent has text we need to split it into a separate unstyled element\n\n      if (parentRecord.getChildKeys().isEmpty() && parentRecord.getText()) {\n        var parentCharacterList = parentRecord.getCharacterList();\n        var parentText = parentRecord.getText();\n        parentTextNodeKey = generateRandomKey();\n        var textNode = new ContentBlockNode({\n          key: parentTextNodeKey,\n          text: parentText,\n          characterList: parentCharacterList,\n          parent: parent,\n          nextSibling: key\n        });\n        acc.contentBlocks.push(textNode);\n        parentRecord = parentRecord.withMutations(function (block) {\n          block.set('characterList', List()).set('text', '').set('children', parentRecord.children.push(textNode.getKey()));\n        });\n      }\n\n      acc.contentBlocks[parentIndex] = parentRecord.set('children', parentRecord.children.push(key));\n    }\n\n    var blockNode = new BlockNodeRecord({\n      key: key,\n      parent: parent,\n      type: type,\n      depth: depth,\n      text: textBlock,\n      characterList: characterList,\n      prevSibling: parentTextNodeKey || (index === 0 || rawBlocks[index - 1].parent !== parent ? null : rawBlocks[index - 1].key),\n      nextSibling: index === rawBlocks.length - 1 || rawBlocks[index + 1].parent !== parent ? null : rawBlocks[index + 1].key\n    }); // insert node\n\n    acc.contentBlocks.push(blockNode); // cache ref for building links\n\n    acc.cacheRef[blockNode.key] = index;\n    return acc;\n  }, initialState).contentBlocks;\n};\n\nvar convertFromHTMLtoContentBlocks = function convertFromHTMLtoContentBlocks(html) {\n  var DOMBuilder = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getSafeBodyFromHTML;\n  var blockRenderMap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DefaultDraftBlockRenderMap; // Be ABSOLUTELY SURE that the dom builder you pass here won't execute\n  // arbitrary code in whatever environment you're running this in. For an\n  // example of how we try to do this in-browser, see getSafeBodyFromHTML.\n  // TODO: replace DraftEntity with an OrderedMap here\n\n  var chunkData = getChunkForHTML(html, DOMBuilder, blockRenderMap, DraftEntity);\n\n  if (chunkData == null) {\n    return null;\n  }\n\n  var chunk = chunkData.chunk,\n      entityMap = chunkData.entityMap;\n  var contentBlocks = convertChunkToContentBlocks(chunk);\n  return {\n    contentBlocks: contentBlocks,\n    entityMap: entityMap\n  };\n};\n\nmodule.exports = convertFromHTMLtoContentBlocks;","map":{"version":3,"names":["_extends","_assign","target","i","arguments","length","source","key","Object","prototype","hasOwnProperty","call","_knownListItemDepthCl","require","_defineProperty","obj","value","defineProperty","enumerable","configurable","writable","CharacterMetadata","ContentBlock","ContentBlockNode","DefaultDraftBlockRenderMap","DraftEntity","DraftFeatureFlags","Immutable","_require","Set","URI","cx","generateRandomKey","getSafeBodyFromHTML","invariant","sanitizeDraftText","experimentalTreeDataSupport","draft_tree_data_support","List","OrderedSet","NBSP","SPACE","MAX_DEPTH","REGEX_CR","RegExp","REGEX_LF","REGEX_NBSP","REGEX_CARRIAGE","REGEX_ZWS","boldValues","notBoldValues","inlineTags","b","code","del","em","s","strike","strong","u","knownListItemDepthClasses","anchorAttr","imgAttr","lastBlock","EMPTY_CHUNK","text","inlines","entities","blocks","EMPTY_BLOCK","children","depth","type","getListBlockType","tag","lastList","getBlockMapSupportedTags","blockRenderMap","unstyledElement","get","element","tags","forEach","draftBlock","aliasedElements","add","filter","toArray","sort","getMultiMatchedType","multiMatchExtractor","ii","matchType","getBlockTypeForTag","matchedTypes","wrapper","some","alias","keySeq","toSet","processInlineTag","node","currentStyle","styleToCheck","toOrderedSet","HTMLElement","htmlElement","withMutations","style","fontWeight","fontStyle","textDecoration","indexOf","remove","joinChunks","A","B","experimentalHasNestedBlocks","lastInA","slice","firstInB","pop","shift","concat","containsSemanticBlockMarkup","html","blockTags","hasValidLinkText","link","HTMLAnchorElement","process","env","NODE_ENV","protocol","getWhitespaceChunk","inEntity","Array","getSoftNewlineChunk","getChunkedBlock","props","undefined","getBlockDividerChunk","block","parentKey","parent","Math","max","min","getListItemDepth","keys","depthClass","classList","contains","genFragment","entityMap","inlineStyle","inBlock","lastLastBlock","nodeName","toLowerCase","newEntityMap","nextBlockType","newBlock","inBlockType","chunk","newChunk","blockKey","_text","textContent","nodeTextContent","trim","parentElement","parentNodeName","replace","fill","HTMLImageElement","attributes","getNamedItem","image","entityConfig","attr","imageAttribute","getAttribute","__create","blockType","inListBlock","inBlockOrHasNestedBlocks","child","firstChild","entityId","href","anchor","anchorAttribute","url","toString","_genFragment","generatedChunk","maybeUpdatedEntityMap","sibling","nextSibling","getChunkForHTML","DOMBuilder","supportedBlockTags","safeBody","workingBlocks","fragment","push","split","unshift","convertChunkToContentBlocks","isArray","initialState","cacheRef","contentBlocks","start","rawBlocks","rawInlines","rawEntities","BlockNodeRecord","reduce","acc","textBlock","index","end","characterList","map","data","entity","create","parentTextNodeKey","parentIndex","parentRecord","getChildKeys","isEmpty","getText","parentCharacterList","getCharacterList","parentText","textNode","set","getKey","blockNode","prevSibling","convertFromHTMLtoContentBlocks","chunkData","module","exports"],"sources":["E:/Work/PFE/Project folder/DocHelp/node_modules/draft-js/lib/convertFromHTMLToContentBlocks.js"],"sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule convertFromHTMLToContentBlocks\n * @format\n * \n */\n\n'use strict';\n\nvar _extends = _assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _knownListItemDepthCl,\n    _assign = require('object-assign');\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar CharacterMetadata = require('./CharacterMetadata');\nvar ContentBlock = require('./ContentBlock');\nvar ContentBlockNode = require('./ContentBlockNode');\nvar DefaultDraftBlockRenderMap = require('./DefaultDraftBlockRenderMap');\nvar DraftEntity = require('./DraftEntity');\nvar DraftFeatureFlags = require('./DraftFeatureFlags');\nvar Immutable = require('immutable');\n\nvar _require = require('immutable'),\n    Set = _require.Set;\n\nvar URI = require('fbjs/lib/URI');\n\nvar cx = require('fbjs/lib/cx');\nvar generateRandomKey = require('./generateRandomKey');\nvar getSafeBodyFromHTML = require('./getSafeBodyFromHTML');\nvar invariant = require('fbjs/lib/invariant');\nvar sanitizeDraftText = require('./sanitizeDraftText');\n\nvar experimentalTreeDataSupport = DraftFeatureFlags.draft_tree_data_support;\n\nvar List = Immutable.List,\n    OrderedSet = Immutable.OrderedSet;\n\n\nvar NBSP = '&nbsp;';\nvar SPACE = ' ';\n\n// Arbitrary max indent\nvar MAX_DEPTH = 4;\n\n// used for replacing characters in HTML\nvar REGEX_CR = new RegExp('\\r', 'g');\nvar REGEX_LF = new RegExp('\\n', 'g');\nvar REGEX_NBSP = new RegExp(NBSP, 'g');\nvar REGEX_CARRIAGE = new RegExp('&#13;?', 'g');\nvar REGEX_ZWS = new RegExp('&#8203;?', 'g');\n\n// https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight\nvar boldValues = ['bold', 'bolder', '500', '600', '700', '800', '900'];\nvar notBoldValues = ['light', 'lighter', '100', '200', '300', '400'];\n\n// Block tag flow is different because LIs do not have\n// a deterministic style ;_;\nvar inlineTags = {\n  b: 'BOLD',\n  code: 'CODE',\n  del: 'STRIKETHROUGH',\n  em: 'ITALIC',\n  i: 'ITALIC',\n  s: 'STRIKETHROUGH',\n  strike: 'STRIKETHROUGH',\n  strong: 'BOLD',\n  u: 'UNDERLINE'\n};\n\nvar knownListItemDepthClasses = (_knownListItemDepthCl = {}, _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth0'), 0), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth1'), 1), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth2'), 2), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth3'), 3), _defineProperty(_knownListItemDepthCl, cx('public/DraftStyleDefault/depth4'), 4), _knownListItemDepthCl);\n\nvar anchorAttr = ['className', 'href', 'rel', 'target', 'title'];\n\nvar imgAttr = ['alt', 'className', 'height', 'src', 'width'];\n\nvar lastBlock = void 0;\n\nvar EMPTY_CHUNK = {\n  text: '',\n  inlines: [],\n  entities: [],\n  blocks: []\n};\n\nvar EMPTY_BLOCK = {\n  children: List(),\n  depth: 0,\n  key: '',\n  type: ''\n};\n\nvar getListBlockType = function getListBlockType(tag, lastList) {\n  if (tag === 'li') {\n    return lastList === 'ol' ? 'ordered-list-item' : 'unordered-list-item';\n  }\n  return null;\n};\n\nvar getBlockMapSupportedTags = function getBlockMapSupportedTags(blockRenderMap) {\n  var unstyledElement = blockRenderMap.get('unstyled').element;\n  var tags = Set([]);\n\n  blockRenderMap.forEach(function (draftBlock) {\n    if (draftBlock.aliasedElements) {\n      draftBlock.aliasedElements.forEach(function (tag) {\n        tags = tags.add(tag);\n      });\n    }\n\n    tags = tags.add(draftBlock.element);\n  });\n\n  return tags.filter(function (tag) {\n    return tag && tag !== unstyledElement;\n  }).toArray().sort();\n};\n\n// custom element conversions\nvar getMultiMatchedType = function getMultiMatchedType(tag, lastList, multiMatchExtractor) {\n  for (var ii = 0; ii < multiMatchExtractor.length; ii++) {\n    var matchType = multiMatchExtractor[ii](tag, lastList);\n    if (matchType) {\n      return matchType;\n    }\n  }\n  return null;\n};\n\nvar getBlockTypeForTag = function getBlockTypeForTag(tag, lastList, blockRenderMap) {\n  var matchedTypes = blockRenderMap.filter(function (draftBlock) {\n    return draftBlock.element === tag || draftBlock.wrapper === tag || draftBlock.aliasedElements && draftBlock.aliasedElements.some(function (alias) {\n      return alias === tag;\n    });\n  }).keySeq().toSet().toArray().sort();\n\n  // if we dont have any matched type, return unstyled\n  // if we have one matched type return it\n  // if we have multi matched types use the multi-match function to gather type\n  switch (matchedTypes.length) {\n    case 0:\n      return 'unstyled';\n    case 1:\n      return matchedTypes[0];\n    default:\n      return getMultiMatchedType(tag, lastList, [getListBlockType]) || 'unstyled';\n  }\n};\n\nvar processInlineTag = function processInlineTag(tag, node, currentStyle) {\n  var styleToCheck = inlineTags[tag];\n  if (styleToCheck) {\n    currentStyle = currentStyle.add(styleToCheck).toOrderedSet();\n  } else if (node instanceof HTMLElement) {\n    var htmlElement = node;\n    currentStyle = currentStyle.withMutations(function (style) {\n      var fontWeight = htmlElement.style.fontWeight;\n      var fontStyle = htmlElement.style.fontStyle;\n      var textDecoration = htmlElement.style.textDecoration;\n\n      if (boldValues.indexOf(fontWeight) >= 0) {\n        style.add('BOLD');\n      } else if (notBoldValues.indexOf(fontWeight) >= 0) {\n        style.remove('BOLD');\n      }\n\n      if (fontStyle === 'italic') {\n        style.add('ITALIC');\n      } else if (fontStyle === 'normal') {\n        style.remove('ITALIC');\n      }\n\n      if (textDecoration === 'underline') {\n        style.add('UNDERLINE');\n      }\n      if (textDecoration === 'line-through') {\n        style.add('STRIKETHROUGH');\n      }\n      if (textDecoration === 'none') {\n        style.remove('UNDERLINE');\n        style.remove('STRIKETHROUGH');\n      }\n    }).toOrderedSet();\n  }\n  return currentStyle;\n};\n\nvar joinChunks = function joinChunks(A, B, experimentalHasNestedBlocks) {\n  // Sometimes two blocks will touch in the DOM and we need to strip the\n  // extra delimiter to preserve niceness.\n  var lastInA = A.text.slice(-1);\n  var firstInB = B.text.slice(0, 1);\n\n  if (lastInA === '\\r' && firstInB === '\\r' && !experimentalHasNestedBlocks) {\n    A.text = A.text.slice(0, -1);\n    A.inlines.pop();\n    A.entities.pop();\n    A.blocks.pop();\n  }\n\n  // Kill whitespace after blocks\n  if (lastInA === '\\r') {\n    if (B.text === SPACE || B.text === '\\n') {\n      return A;\n    } else if (firstInB === SPACE || firstInB === '\\n') {\n      B.text = B.text.slice(1);\n      B.inlines.shift();\n      B.entities.shift();\n    }\n  }\n\n  return {\n    text: A.text + B.text,\n    inlines: A.inlines.concat(B.inlines),\n    entities: A.entities.concat(B.entities),\n    blocks: A.blocks.concat(B.blocks)\n  };\n};\n\n/**\n * Check to see if we have anything like <p> <blockquote> <h1>... to create\n * block tags from. If we do, we can use those and ignore <div> tags. If we\n * don't, we can treat <div> tags as meaningful (unstyled) blocks.\n */\nvar containsSemanticBlockMarkup = function containsSemanticBlockMarkup(html, blockTags) {\n  return blockTags.some(function (tag) {\n    return html.indexOf('<' + tag) !== -1;\n  });\n};\n\nvar hasValidLinkText = function hasValidLinkText(link) {\n  !(link instanceof HTMLAnchorElement) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Link must be an HTMLAnchorElement.') : invariant(false) : void 0;\n  var protocol = link.protocol;\n  return protocol === 'http:' || protocol === 'https:' || protocol === 'mailto:';\n};\n\nvar getWhitespaceChunk = function getWhitespaceChunk(inEntity) {\n  var entities = new Array(1);\n  if (inEntity) {\n    entities[0] = inEntity;\n  }\n  return _extends({}, EMPTY_CHUNK, {\n    text: SPACE,\n    inlines: [OrderedSet()],\n    entities: entities\n  });\n};\n\nvar getSoftNewlineChunk = function getSoftNewlineChunk() {\n  return _extends({}, EMPTY_CHUNK, {\n    text: '\\n',\n    inlines: [OrderedSet()],\n    entities: new Array(1)\n  });\n};\n\nvar getChunkedBlock = function getChunkedBlock() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  return _extends({}, EMPTY_BLOCK, props);\n};\n\nvar getBlockDividerChunk = function getBlockDividerChunk(block, depth) {\n  var parentKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  return {\n    text: '\\r',\n    inlines: [OrderedSet()],\n    entities: new Array(1),\n    blocks: [getChunkedBlock({\n      parent: parentKey,\n      key: generateRandomKey(),\n      type: block,\n      depth: Math.max(0, Math.min(MAX_DEPTH, depth))\n    })]\n  };\n};\n\n/**\n *  If we're pasting from one DraftEditor to another we can check to see if\n *  existing list item depth classes are being used and preserve this style\n */\nvar getListItemDepth = function getListItemDepth(node) {\n  var depth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  Object.keys(knownListItemDepthClasses).some(function (depthClass) {\n    if (node.classList.contains(depthClass)) {\n      depth = knownListItemDepthClasses[depthClass];\n    }\n  });\n  return depth;\n};\n\nvar genFragment = function genFragment(entityMap, node, inlineStyle, lastList, inBlock, blockTags, depth, blockRenderMap, inEntity, parentKey) {\n  var lastLastBlock = lastBlock;\n  var nodeName = node.nodeName.toLowerCase();\n  var newEntityMap = entityMap;\n  var nextBlockType = 'unstyled';\n  var newBlock = false;\n  var inBlockType = inBlock && getBlockTypeForTag(inBlock, lastList, blockRenderMap);\n  var chunk = _extends({}, EMPTY_CHUNK);\n  var newChunk = null;\n  var blockKey = void 0;\n\n  // Base Case\n  if (nodeName === '#text') {\n    var _text = node.textContent;\n    var nodeTextContent = _text.trim();\n\n    // We should not create blocks for leading spaces that are\n    // existing around ol/ul and their children list items\n    if (lastList && nodeTextContent === '' && node.parentElement) {\n      var parentNodeName = node.parentElement.nodeName.toLowerCase();\n      if (parentNodeName === 'ol' || parentNodeName === 'ul') {\n        return { chunk: _extends({}, EMPTY_CHUNK), entityMap: entityMap };\n      }\n    }\n\n    if (nodeTextContent === '' && inBlock !== 'pre') {\n      return { chunk: getWhitespaceChunk(inEntity), entityMap: entityMap };\n    }\n    if (inBlock !== 'pre') {\n      // Can't use empty string because MSWord\n      _text = _text.replace(REGEX_LF, SPACE);\n    }\n\n    // save the last block so we can use it later\n    lastBlock = nodeName;\n\n    return {\n      chunk: {\n        text: _text,\n        inlines: Array(_text.length).fill(inlineStyle),\n        entities: Array(_text.length).fill(inEntity),\n        blocks: []\n      },\n      entityMap: entityMap\n    };\n  }\n\n  // save the last block so we can use it later\n  lastBlock = nodeName;\n\n  // BR tags\n  if (nodeName === 'br') {\n    if (lastLastBlock === 'br' && (!inBlock || inBlockType === 'unstyled')) {\n      return {\n        chunk: getBlockDividerChunk('unstyled', depth, parentKey),\n        entityMap: entityMap\n      };\n    }\n    return { chunk: getSoftNewlineChunk(), entityMap: entityMap };\n  }\n\n  // IMG tags\n  if (nodeName === 'img' && node instanceof HTMLImageElement && node.attributes.getNamedItem('src') && node.attributes.getNamedItem('src').value) {\n    var image = node;\n    var entityConfig = {};\n\n    imgAttr.forEach(function (attr) {\n      var imageAttribute = image.getAttribute(attr);\n      if (imageAttribute) {\n        entityConfig[attr] = imageAttribute;\n      }\n    });\n    // Forcing this node to have children because otherwise no entity will be\n    // created for this node.\n    // The child text node cannot just have a space or return as content -\n    // we strip those out.\n    // See https://github.com/facebook/draft-js/issues/231 for some context.\n    node.textContent = '\\uD83D\\uDCF7';\n\n    // TODO: update this when we remove DraftEntity entirely\n    inEntity = DraftEntity.__create('IMAGE', 'MUTABLE', entityConfig || {});\n  }\n\n  // Inline tags\n  inlineStyle = processInlineTag(nodeName, node, inlineStyle);\n\n  // Handle lists\n  if (nodeName === 'ul' || nodeName === 'ol') {\n    if (lastList) {\n      depth += 1;\n    }\n    lastList = nodeName;\n  }\n\n  if (!experimentalTreeDataSupport && nodeName === 'li' && node instanceof HTMLElement) {\n    depth = getListItemDepth(node, depth);\n  }\n\n  var blockType = getBlockTypeForTag(nodeName, lastList, blockRenderMap);\n  var inListBlock = lastList && inBlock === 'li' && nodeName === 'li';\n  var inBlockOrHasNestedBlocks = (!inBlock || experimentalTreeDataSupport) && blockTags.indexOf(nodeName) !== -1;\n\n  // Block Tags\n  if (inListBlock || inBlockOrHasNestedBlocks) {\n    chunk = getBlockDividerChunk(blockType, depth, parentKey);\n    blockKey = chunk.blocks[0].key;\n    inBlock = nodeName;\n    newBlock = !experimentalTreeDataSupport;\n  }\n\n  // this is required so that we can handle 'ul' and 'ol'\n  if (inListBlock) {\n    nextBlockType = lastList === 'ul' ? 'unordered-list-item' : 'ordered-list-item';\n  }\n\n  // Recurse through children\n  var child = node.firstChild;\n  if (child != null) {\n    nodeName = child.nodeName.toLowerCase();\n  }\n\n  var entityId = null;\n\n  while (child) {\n    if (child instanceof HTMLAnchorElement && child.href && hasValidLinkText(child)) {\n      (function () {\n        var anchor = child;\n        var entityConfig = {};\n\n        anchorAttr.forEach(function (attr) {\n          var anchorAttribute = anchor.getAttribute(attr);\n          if (anchorAttribute) {\n            entityConfig[attr] = anchorAttribute;\n          }\n        });\n\n        entityConfig.url = new URI(anchor.href).toString();\n        // TODO: update this when we remove DraftEntity completely\n        entityId = DraftEntity.__create('LINK', 'MUTABLE', entityConfig || {});\n      })();\n    } else {\n      entityId = undefined;\n    }\n\n    var _genFragment = genFragment(newEntityMap, child, inlineStyle, lastList, inBlock, blockTags, depth, blockRenderMap, entityId || inEntity, experimentalTreeDataSupport ? blockKey : null),\n        generatedChunk = _genFragment.chunk,\n        maybeUpdatedEntityMap = _genFragment.entityMap;\n\n    newChunk = generatedChunk;\n    newEntityMap = maybeUpdatedEntityMap;\n\n    chunk = joinChunks(chunk, newChunk, experimentalTreeDataSupport);\n    var sibling = child.nextSibling;\n\n    // Put in a newline to break up blocks inside blocks\n    if (!parentKey && sibling && blockTags.indexOf(nodeName) >= 0 && inBlock) {\n      chunk = joinChunks(chunk, getSoftNewlineChunk());\n    }\n    if (sibling) {\n      nodeName = sibling.nodeName.toLowerCase();\n    }\n    child = sibling;\n  }\n\n  if (newBlock) {\n    chunk = joinChunks(chunk, getBlockDividerChunk(nextBlockType, depth, parentKey));\n  }\n\n  return { chunk: chunk, entityMap: newEntityMap };\n};\n\nvar getChunkForHTML = function getChunkForHTML(html, DOMBuilder, blockRenderMap, entityMap) {\n  html = html.trim().replace(REGEX_CR, '').replace(REGEX_NBSP, SPACE).replace(REGEX_CARRIAGE, '').replace(REGEX_ZWS, '');\n\n  var supportedBlockTags = getBlockMapSupportedTags(blockRenderMap);\n\n  var safeBody = DOMBuilder(html);\n  if (!safeBody) {\n    return null;\n  }\n  lastBlock = null;\n\n  // Sometimes we aren't dealing with content that contains nice semantic\n  // tags. In this case, use divs to separate everything out into paragraphs\n  // and hope for the best.\n  var workingBlocks = containsSemanticBlockMarkup(html, supportedBlockTags) ? supportedBlockTags : ['div'];\n\n  // Start with -1 block depth to offset the fact that we are passing in a fake\n  // UL block to start with.\n  var fragment = genFragment(entityMap, safeBody, OrderedSet(), 'ul', null, workingBlocks, -1, blockRenderMap);\n\n  var chunk = fragment.chunk;\n  var newEntityMap = fragment.entityMap;\n\n  // join with previous block to prevent weirdness on paste\n  if (chunk.text.indexOf('\\r') === 0) {\n    chunk = {\n      text: chunk.text.slice(1),\n      inlines: chunk.inlines.slice(1),\n      entities: chunk.entities.slice(1),\n      blocks: chunk.blocks\n    };\n  }\n\n  // Kill block delimiter at the end\n  if (chunk.text.slice(-1) === '\\r') {\n    chunk.text = chunk.text.slice(0, -1);\n    chunk.inlines = chunk.inlines.slice(0, -1);\n    chunk.entities = chunk.entities.slice(0, -1);\n    chunk.blocks.pop();\n  }\n\n  // If we saw no block tags, put an unstyled one in\n  if (chunk.blocks.length === 0) {\n    chunk.blocks.push(_extends({}, EMPTY_CHUNK, {\n      type: 'unstyled',\n      depth: 0\n    }));\n  }\n\n  // Sometimes we start with text that isn't in a block, which is then\n  // followed by blocks. Need to fix up the blocks to add in\n  // an unstyled block for this content\n  if (chunk.text.split('\\r').length === chunk.blocks.length + 1) {\n    chunk.blocks.unshift({ type: 'unstyled', depth: 0 });\n  }\n\n  return { chunk: chunk, entityMap: newEntityMap };\n};\n\nvar convertChunkToContentBlocks = function convertChunkToContentBlocks(chunk) {\n  if (!chunk || !chunk.text || !Array.isArray(chunk.blocks)) {\n    return null;\n  }\n\n  var initialState = {\n    cacheRef: {},\n    contentBlocks: []\n  };\n\n  var start = 0;\n\n  var rawBlocks = chunk.blocks,\n      rawInlines = chunk.inlines,\n      rawEntities = chunk.entities;\n\n\n  var BlockNodeRecord = experimentalTreeDataSupport ? ContentBlockNode : ContentBlock;\n\n  return chunk.text.split('\\r').reduce(function (acc, textBlock, index) {\n    // Make absolutely certain that our text is acceptable.\n    textBlock = sanitizeDraftText(textBlock);\n\n    var block = rawBlocks[index];\n    var end = start + textBlock.length;\n    var inlines = rawInlines.slice(start, end);\n    var entities = rawEntities.slice(start, end);\n    var characterList = List(inlines.map(function (style, index) {\n      var data = { style: style, entity: null };\n      if (entities[index]) {\n        data.entity = entities[index];\n      }\n      return CharacterMetadata.create(data);\n    }));\n    start = end + 1;\n\n    var depth = block.depth,\n        type = block.type,\n        parent = block.parent;\n\n\n    var key = block.key || generateRandomKey();\n    var parentTextNodeKey = null; // will be used to store container text nodes\n\n    // childrens add themselves to their parents since we are iterating in order\n    if (parent) {\n      var parentIndex = acc.cacheRef[parent];\n      var parentRecord = acc.contentBlocks[parentIndex];\n\n      // if parent has text we need to split it into a separate unstyled element\n      if (parentRecord.getChildKeys().isEmpty() && parentRecord.getText()) {\n        var parentCharacterList = parentRecord.getCharacterList();\n        var parentText = parentRecord.getText();\n        parentTextNodeKey = generateRandomKey();\n\n        var textNode = new ContentBlockNode({\n          key: parentTextNodeKey,\n          text: parentText,\n          characterList: parentCharacterList,\n          parent: parent,\n          nextSibling: key\n        });\n\n        acc.contentBlocks.push(textNode);\n\n        parentRecord = parentRecord.withMutations(function (block) {\n          block.set('characterList', List()).set('text', '').set('children', parentRecord.children.push(textNode.getKey()));\n        });\n      }\n\n      acc.contentBlocks[parentIndex] = parentRecord.set('children', parentRecord.children.push(key));\n    }\n\n    var blockNode = new BlockNodeRecord({\n      key: key,\n      parent: parent,\n      type: type,\n      depth: depth,\n      text: textBlock,\n      characterList: characterList,\n      prevSibling: parentTextNodeKey || (index === 0 || rawBlocks[index - 1].parent !== parent ? null : rawBlocks[index - 1].key),\n      nextSibling: index === rawBlocks.length - 1 || rawBlocks[index + 1].parent !== parent ? null : rawBlocks[index + 1].key\n    });\n\n    // insert node\n    acc.contentBlocks.push(blockNode);\n\n    // cache ref for building links\n    acc.cacheRef[blockNode.key] = index;\n\n    return acc;\n  }, initialState).contentBlocks;\n};\n\nvar convertFromHTMLtoContentBlocks = function convertFromHTMLtoContentBlocks(html) {\n  var DOMBuilder = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getSafeBodyFromHTML;\n  var blockRenderMap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DefaultDraftBlockRenderMap;\n\n  // Be ABSOLUTELY SURE that the dom builder you pass here won't execute\n  // arbitrary code in whatever environment you're running this in. For an\n  // example of how we try to do this in-browser, see getSafeBodyFromHTML.\n\n  // TODO: replace DraftEntity with an OrderedMap here\n  var chunkData = getChunkForHTML(html, DOMBuilder, blockRenderMap, DraftEntity);\n\n  if (chunkData == null) {\n    return null;\n  }\n\n  var chunk = chunkData.chunk,\n      entityMap = chunkData.entityMap;\n\n  var contentBlocks = convertChunkToContentBlocks(chunk);\n\n  return {\n    contentBlocks: contentBlocks,\n    entityMap: entityMap\n  };\n};\n\nmodule.exports = convertFromHTMLtoContentBlocks;"],"mappings":"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"},"metadata":{},"sourceType":"script"}